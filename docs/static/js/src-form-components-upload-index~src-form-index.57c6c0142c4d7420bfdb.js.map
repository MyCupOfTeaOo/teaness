{"version":3,"sources":["D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/context.ts","D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/Registry.ts","D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/decorator.tsx","D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/index.tsx","D:/zouwendi/01projectFiles/teaness/src/Img/index.tsx","D:/zouwendi/01projectFiles/teaness/src/Modal/index.tsx","D:/zouwendi/01projectFiles/teaness/src/Spin/index.tsx","D:/zouwendi/01projectFiles/teaness/src/hooks/index.ts"],"names":["UploadContext","React","createContext","register","unregister","upload","p","Promise","cancel","Registry","strokeColor","bind","options","errorBack","WrappedComponent","props","registry","useMemo","Set","memo","useState","loadings","setLoadings","visible","setVisible","uploadingPromises","useCallback","ref","add","toUpload","Array","from","length","message","error","resolve","all","map","item","fileList","file","status","percent","prevLoadings","uid","resp","then","info","uniqueId","push","err","setFileList","prevFileList","target","find","f","console","reject","lodash","omit","reduce","prev","cur","concat","res","Modal","title","className","content","forEach","name","waitSearch","Object","keys","key","unset","onCancel","Provider","value","maskClosable","footer","Img","src","thumbUrl","url","handlePreview","listType","onPreview","onDownLoad","window","open","Upload","onChange","onSelect","getInfoErrorback","g","getFileInfo","children","loading","maxSize","max","rest","context","useContext","unmount","isLoading","handle","r","split","filter","join","isEmpty","undefined","size","first","slice","useEffect","oldFileList","uids","t","type","index","isArray","every","prevFile","temp","values","beforeUpload","child","icon","disabled","onDownload","defaultProps","style","display","alignItems","width","create","useEffectState","backupSrc","setSrc","alt","onError","ModalComponent","params","div","document","createElement","isCancel","onOk","args2","args","render","setTimeout","destory","ReactDOM","unmountComponentAtNode","parentNode","removeChild","body","appendChild","AModal","centered","success","confirm","warning","SquareSpin","classnames","TreblingCircle","SpinStretch","Dots","Circle","viewBox","cx","cy","deps","state","setState","useEffectExcludeFirst","effect","count","useRef","current","useEffectExcludeNum","num"],"mappings":"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","file":"static/js/src-form-components-upload-index~src-form-index.5f09338c.js","sourcesContent":["import React from 'react';\nimport { UploadContextType } from './typings';\nimport { CancellablePromise } from '../../../typings';\n\nexport const UploadContext = React.createContext<UploadContextType>({\n  register: () => {},\n  unregister: () => {},\n  upload: () => {\n    const p = new Promise(() => {});\n    (p as CancellablePromise<boolean>).cancel = () => {};\n    return p as CancellablePromise<boolean>;\n  },\n});\n","import { UploadFile, onUpload, GetFileInfoType } from './typings';\n\nconst Registry: {\n  onDownLoad?: (file: UploadFile) => void;\n  onPreview?: (file: UploadFile) => void;\n  upload?: onUpload;\n  getFileInfo?: GetFileInfoType;\n} = {};\n\nexport default Registry;\n","import React, { useCallback, useMemo, useState } from 'react';\nimport lodash from 'lodash-es';\nimport { message, Progress } from 'antd';\nimport Modal from '../../../Modal';\nimport { UploadContext } from './context';\nimport { UploadRefType, UploadFile, onUpload } from './typings';\nimport Registry from './Registry';\nimport './styles.scss';\nimport Img from '../../../Img';\nimport { CancellablePromise } from '../../../typings';\n\nexport interface OptionsType {\n  errorBack?: (err: any) => void;\n  upload?: onUpload;\n}\n\nconst strokeColor = {\n  '0%': '#108ee9',\n  '100%': '#87d068',\n};\n\nexport const bind = (options: OptionsType = {}) => {\n  const { errorBack } = options;\n  return function<T>(WrappedComponent: React.ComponentType<T>) {\n    return (props: T) => {\n      const registry = useMemo<Set<UploadRefType>>(() => new Set(), []);\n      const memo = useMemo<{\n        [key: string]: string[];\n      }>(() => ({}), []);\n      const [loadings, setLoadings] = useState<{\n        [key: string]: UploadFile;\n      }>({});\n      const [visible, setVisible] = useState(false);\n      const uploadingPromises = useMemo<Set<CancellablePromise<any>>>(\n        () => new Set(),\n        [],\n      );\n\n      const register = useCallback((ref: UploadRefType) => {\n        registry.add(ref);\n      }, []);\n      const unregister = useCallback((ref: UploadRefType) => {\n        registry.delete(ref);\n      }, []);\n\n      const upload = useCallback(() => {\n        const toUpload = options.upload || Registry.upload;\n        const registryArray = Array.from(registry);\n        if (registryArray.length > 0) {\n          if (!toUpload) {\n            message.error('未找到上传方法');\n            const p = Promise.resolve(false);\n            (p as CancellablePromise<boolean>).cancel = () => {};\n            return p as CancellablePromise<boolean>;\n          }\n          const depth = Array.from(registry).map(item => {\n            if (item.fileList) {\n              return item.fileList.map(file => {\n                // 找到需要上传的 后面那个判断只是为了类型推导\n                if (!file.status && file.percent === 0 && toUpload) {\n                  setVisible(true);\n                  setLoadings(prevLoadings => {\n                    return {\n                      ...prevLoadings,\n                      [file.uid]: {\n                        ...file,\n                        status: 'uploading',\n                      },\n                    };\n                  });\n                  const resp = toUpload(file, percent => {\n                    setLoadings(prevLoadings => {\n                      return {\n                        ...prevLoadings,\n                        [file.uid]: {\n                          ...file,\n                          status: percent < 100 ? 'uploading' : 'done',\n                          percent,\n                        },\n                      };\n                    });\n                  });\n                  uploadingPromises.add(resp);\n\n                  resp\n                    .then(info => {\n                      if (!memo[item.uniqueId]) {\n                        memo[item.uniqueId] = [info.uid];\n                      } else {\n                        memo[item.uniqueId].push(info.uid);\n                      }\n                      uploadingPromises.delete(resp);\n                    })\n                    .catch(err => {\n                      // 上传失败的\n                      item.setFileList(prevFileList => {\n                        if (prevFileList) {\n                          const target = prevFileList.find(\n                            f => f.uid === file.uid,\n                          );\n                          if (target) target.status = 'error';\n                          return [...prevFileList];\n                        }\n                        return prevFileList;\n                      });\n                      if (errorBack) errorBack(err);\n                      else console.error(err);\n                      uploadingPromises.delete(resp);\n                      return Promise.reject(err);\n                    })\n                    .finally(() => {\n                      setLoadings(prevLoadings => {\n                        return lodash.omit(prevLoadings, file.uid);\n                      });\n                    });\n                  return resp;\n                }\n                return null;\n              });\n            }\n            return [];\n          });\n          const all = depth.reduce((prev, cur) => {\n            if (cur) return prev.concat(cur);\n            return prev;\n          }, []);\n          const p = Promise.all(all)\n            .then(() => true)\n            .catch(() => false)\n            .then(res => {\n              setVisible(false);\n              if (!res) {\n                Modal.error({\n                  title: '有文件上传失败',\n                  className: 'tea-upload-error-modal',\n                  content: (\n                    <ul className=\"tea-upload-error-list\">\n                      {Array.from(registry)\n                        .reduce<UploadFile[]>((prev, cur) => {\n                          if (cur.fileList) {\n                            cur.fileList.forEach(item => {\n                              if (item.status === 'error') {\n                                prev.push(item);\n                              }\n                            });\n                          }\n                          return prev;\n                        }, [])\n                        .map(item => (\n                          <li title={item.name}>{item.name}</li>\n                        ))}\n                    </ul>\n                  ),\n                });\n              }\n              return res;\n            })\n            .finally(() => {\n              const waitSearch = Array.from(registry);\n              Object.keys(memo).forEach(key => {\n                const target = waitSearch.find(item => item.uniqueId === key);\n                if (target && target.add) {\n                  target.add(memo[key]);\n                }\n                lodash.unset(memo, key);\n              });\n            });\n          (p as CancellablePromise<boolean>).cancel = () => {\n            all.forEach(item => {\n              if (item) item.cancel();\n            });\n          };\n          return p as CancellablePromise<boolean>;\n        } else {\n          const p = Promise.resolve(true);\n          (p as CancellablePromise<boolean>).cancel = () => {};\n          return p as CancellablePromise<boolean>;\n        }\n      }, []);\n      const onCancel = useCallback(() => {\n        setVisible(false);\n        Array.from(uploadingPromises).forEach(item => {\n          item.cancel();\n        });\n      }, []);\n      return (\n        <UploadContext.Provider value={{ register, unregister, upload }}>\n          <Modal\n            className=\"tea-upload-modal\"\n            maskClosable={false}\n            onCancel={onCancel}\n            footer={null}\n            visible={visible}\n          >\n            <ul className=\"tea-upload-modal-body\">\n              {Object.keys(loadings).map(key => (\n                <li key={key}>\n                  <Img\n                    className=\"tea-upload-modal-img\"\n                    src={loadings[key].thumbUrl || loadings[key].url}\n                  />\n                  <div className=\"tea-upload-modal-content\">\n                    <span className=\"tea-upload-modal-title\">\n                      {loadings[key].name}\n                    </span>\n                    <Progress\n                      strokeColor={strokeColor}\n                      percent={loadings[key].percent}\n                    />\n                  </div>\n                </li>\n              ))}\n            </ul>\n          </Modal>\n          <WrappedComponent {...props} />\n        </UploadContext.Provider>\n      );\n    };\n  };\n};\n","import React, {\n  useState,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n} from 'react';\nimport { Upload as AntUpload, Button, message } from 'antd';\nimport lodash from 'lodash-es';\nimport { UploadListType } from 'antd/lib/upload/interface';\nimport { Circle } from '../../../Spin';\nimport { UploadContext } from './context';\nimport {\n  UploadProps,\n  UploadFile,\n  UploadChangeParam,\n  UploadRefType,\n} from './typings';\nimport Registry from './Registry';\nimport { bind } from './decorator';\n\nexport function handlePreview(\n  file: UploadFile,\n  listType?: UploadListType,\n): void {\n  switch (listType) {\n    case 'picture':\n    case 'picture-card':\n      if (Registry.onPreview) Registry.onPreview(file);\n      break;\n    default:\n      if (Registry.onDownLoad) Registry.onDownLoad(file);\n      else if (file.url) window.open(file.url);\n  }\n}\n\nconst Upload: React.FC<UploadProps> & { create: typeof bind } = props => {\n  const {\n    value,\n    onChange,\n    onSelect,\n    getInfoErrorback,\n    getFileInfo: g,\n    children,\n    loading,\n    maxSize,\n    max,\n    ...rest\n  } = props;\n  const context = useContext(UploadContext);\n  const memo = useMemo(\n    () => ({\n      unmount: false,\n      uniqueId: lodash.uniqueId('upload'),\n    }),\n    [],\n  );\n  const [loadings, setLoadings] = useState<{ [key: string]: boolean }>({});\n  const isLoading = useMemo(() => Object.keys(loadings).length > 0, [loadings]);\n  const getFileInfo = useMemo(() => g || Registry.getFileInfo, [g]);\n  const [fileList, setFileList] = useState<UploadFile[]>();\n  const handle = useCallback(\n    (info: UploadChangeParam) => {\n      const target = info.fileList.find(item => item.uid === info.file.uid);\n      setFileList(prevFileList => {\n        // 已上传删除的可能会这样\n        if (!target) {\n          if (onChange && value && info.file.status === 'removed') {\n            const fl = value.split(',');\n            const r = fl.filter(item => item !== info.file.uid).join(',');\n            onChange(lodash.isEmpty(r) ? undefined : r);\n          }\n          if (prevFileList) return prevFileList.filter(item => item.uid !== info.file.uid);\n          else return undefined;\n        }\n\n        // 删除\n        if (target.status === 'removed') {\n          if (onChange && value) {\n            const fl = value.split(',');\n            const r = fl.filter(item => item !== info.file.uid).join(',');\n            onChange(lodash.isEmpty(r) ? undefined : r);\n          }\n          if (prevFileList) return prevFileList.filter(item => item.uid !== target.uid);\n          else return undefined;\n        }\n\n        if (maxSize) {\n          if (target.size / 1024 > maxSize) {\n            message.error(`文件最大只能上传${maxSize}KB`);\n            return prevFileList;\n          }\n        }\n        // 增加\n        if (prevFileList) {\n          if (max && prevFileList.length === max) {\n            // 多文件时可能会超过max\n\n            // 需要判断这一个是不是value的\n            const first = prevFileList[0];\n            if (value && onChange) {\n              const fl = value.split(',');\n              const r = fl.filter(item => item !== first.uid).join(',');\n              onChange(lodash.isEmpty(r) ? undefined : r);\n            }\n\n            return prevFileList.slice(1).concat([target]);\n          }\n          return prevFileList.concat([target]);\n        } else {\n          return [target];\n        }\n      });\n      if (onSelect) onSelect(info);\n    },\n    [onChange, value],\n  );\n\n  useEffect(() => {\n    let unmount = false;\n    const oldFileList: UploadFile[] = [];\n    if (value && getFileInfo) {\n      const uids = value.split(',');\n      const all = uids.map(uid => {\n        if (fileList) {\n          const target = fileList.find(file => file.uid === uid);\n          if (target) {\n            oldFileList.push(target);\n            const t = Promise.resolve({\n              size: target.size,\n              name: target.name,\n              type: target.type,\n              url: target.url,\n            }) as Promise<{\n              size: number;\n              name: string;\n              type: string;\n              url: string;\n            }> & {\n              cancel: () => void;\n            };\n            t.cancel = () => {};\n            return t;\n          }\n        }\n        setLoadings(prev => ({\n          ...prev,\n          [uid]: true,\n        }));\n        return getFileInfo(uid);\n      });\n      // 清空\n      setFileList(oldFileList);\n      all.forEach((resp, index) => {\n        const uid = uids[index];\n        resp\n          .then(item => {\n            if (unmount) return;\n            setFileList(prevFileList => {\n              if (Array.isArray(prevFileList)) {\n                if (prevFileList.every(prevFile => prevFile.uid !== uid)) {\n                  return prevFileList.concat([\n                    {\n                      uid,\n                      size: item.size,\n                      name: item.name,\n                      url: item.url,\n                      type: item.type,\n                      status: 'done',\n                    },\n                  ]);\n                } else {\n                  return prevFileList;\n                }\n              } else {\n                return [\n                  {\n                    uid,\n                    size: item.size,\n                    name: item.name,\n                    url: item.url,\n                    type: item.type,\n                    status: 'done',\n                  },\n                ];\n              }\n            });\n          })\n          .catch(err => {\n            if (unmount) return;\n            setFileList(prevFileList => {\n              if (Array.isArray(prevFileList)) {\n                return prevFileList.concat([\n                  {\n                    uid,\n                    name: '文件信息加载失败',\n                    size: 0,\n                    status: 'error',\n                    type: 'null',\n                  },\n                ]);\n              } else {\n                return [\n                  {\n                    uid,\n                    name: '文件信息加载失败',\n                    size: 0,\n                    status: 'error',\n                    type: 'null',\n                  },\n                ];\n              }\n            });\n            if (getInfoErrorback) getInfoErrorback(uid, err);\n            else console.error('文件信息加载失败', err);\n          })\n          .finally(() => {\n            if (!memo.unmount) setLoadings(prev => lodash.omit(prev, uid));\n          });\n      });\n      return () => {\n        unmount = true;\n        all.forEach(item => item.cancel());\n      };\n    }\n  }, [value]);\n  useEffect(() => {\n    return () => {\n      memo.unmount = true;\n    };\n  }, []);\n  useEffect(() => {\n    const temp: UploadRefType = {\n      uniqueId: memo.uniqueId,\n      fileList,\n      setFileList,\n      add: (values: string[]) => {\n        if (props.onChange && values.length > 0) {\n          if (value) {\n            props.onChange(`${value},${values.join(',')}`);\n          } else {\n            props.onChange(values.join(','));\n          }\n        }\n      },\n    };\n    if (context.register) {\n      context.register(temp);\n      return () => {\n        if (context.unregister) {\n          context.unregister(temp);\n        }\n      };\n    }\n  }, [context, fileList, setFileList, value]);\n  const beforeUpload = useCallback(() => false, []);\n  const child = useMemo(() => {\n    if (isLoading) return loading;\n    if (!max) {\n      return (\n        children || (\n          <Button icon=\"upload\" disabled={props.disabled}>\n            上传\n          </Button>\n        )\n      );\n    }\n    if (!fileList) {\n      return (\n        children || (\n          <Button icon=\"upload\" disabled={props.disabled}>\n            上传\n          </Button>\n        )\n      );\n    }\n    if (fileList.length < max) {\n      return (\n        children || (\n          <Button icon=\"upload\" disabled={props.disabled}>\n            上传\n          </Button>\n        )\n      );\n    }\n    return undefined;\n  }, [children, fileList, isLoading, loading, props.disabled]);\n  const onPreview = useCallback(file => handlePreview(file, props.listType), [\n    props.listType,\n  ]);\n  return (\n    <AntUpload\n      onPreview={onPreview}\n      onDownload={Registry.onDownLoad}\n      beforeUpload={beforeUpload}\n      fileList={fileList}\n      onChange={handle}\n      {...rest}\n    >\n      {child}\n    </AntUpload>\n  );\n};\n\nUpload.defaultProps = {\n  loading: (\n    <div style={{ display: 'flex', alignItems: 'center' }}>\n      <Circle style={{ width: 24 }} />\n      文件信息加载中...\n    </div>\n  ),\n};\n\nUpload.create = bind;\n\nexport { UploadContext, Registry };\nexport default Upload;\n","import React from 'react';\nimport { useEffectState } from '../hooks/index';\n\nexport interface ImgProps {\n  /**\n   * 第一顺位图片\n   */\n  src?: string;\n  /**\n   * 备用图片 默认使用file.svg\n   */\n  backupSrc?: string;\n  alt?: string;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nconst Img: React.FC<ImgProps> = props => {\n  const [src, setSrc] = useEffectState(props.src || props.backupSrc, [\n    props.src,\n  ]);\n  return (\n    <img\n      className={props.className}\n      style={props.style}\n      alt={props.alt}\n      src={src}\n      onError={() => setSrc(props.backupSrc)}\n    />\n  );\n};\nImg.defaultProps = {\n  backupSrc:\n    'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+CiAgPHBhdGggZmlsbD0iI0Q5RDlEOSIgZD0iTTUzNCAzNTJWMTM2SDIzMnY3NTJoNTYwVjM5NEg1NzZhNDIgNDIgMCAwIDEtNDItNDJ6Ii8+CiAgPHBhdGggZD0iTTg1NC42IDI4OC42TDYzOS40IDczLjRjLTYtNi0xNC4xLTkuNC0yMi42LTkuNEgxOTJjLTE3LjcgMC0zMiAxNC4zLTMyIDMydjgzMmMwIDE3LjcgMTQuMyAzMiAzMiAzMmg2NDBjMTcuNyAwIDMyLTE0LjMgMzItMzJWMzExLjNjMC04LjUtMy40LTE2LjctOS40LTIyLjd6TTYwMiAxMzcuOEw3OTAuMiAzMjZINjAyVjEzNy44ek03OTIgODg4SDIzMlYxMzZoMzAydjIxNmE0MiA0MiAwIDAgMCA0MiA0MmgyMTZ2NDk0eiIvPgo8L3N2Zz4K',\n};\nexport default Img;\n","import { Modal as AModal } from 'antd';\nimport { ModalProps } from 'antd/lib/modal';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\ninterface OpenBase {\n  visible?: boolean;\n  onCancel?: (...args: any[]) => void | Promise<any>;\n  onOk?: (...args: any[]) => void | Promise<any>;\n}\n\nexport function open<T extends OpenBase>(\n  ModalComponent: React.ComponentType<T>,\n  params: T,\n) {\n  const div = document.createElement('div');\n  let isCancel = false;\n  document.body.appendChild(div);\n  function onOk(...args2: any[]) {\n    if (params.onOk) params.onOk(args2);\n    onCancel();\n  }\n  function onCancel(...args: any[]) {\n    if (params.onCancel) params.onCancel(args);\n\n    render({ ...params, onCancel, onOk, visible: false });\n    isCancel = true;\n    return new Promise(resolve =>\n      setTimeout(() => {\n        destory();\n        resolve(true);\n      }, 200),\n    );\n  }\n  function destory() {\n    if (isCancel) {\n      const unmountResult = ReactDOM.unmountComponentAtNode(div);\n      if (unmountResult && div.parentNode) {\n        div.parentNode.removeChild(div);\n      }\n    } else {\n      onCancel();\n    }\n  }\n  function render(props: T) {\n    ReactDOM.render(<ModalComponent {...props} />, div);\n  }\n  render({ ...params, onCancel, onOk, visible: true });\n  return {\n    render,\n    onCancel,\n    destory,\n  };\n}\n\nclass Modal extends AModal {\n  static open = (props: ModalProps & { children?: React.ReactNode }) =>\n    open(Modal, props);\n\n  constructor(props: ModalProps, context: {}) {\n    super(props, context);\n  }\n}\n\nModal.error = props => AModal.error({ centered: true, ...props });\nModal.success = props => AModal.success({ centered: true, ...props });\nModal.confirm = props => AModal.confirm({ centered: true, ...props });\nModal.warning = props => AModal.warning({ centered: true, ...props });\n\nexport default Modal;\n","import React, { CSSProperties } from 'react';\nimport classnames from 'classnames';\nimport './index.scss';\n\nexport interface BaseSpinPorps {\n  className?: string;\n  style?: CSSProperties;\n}\n\nexport interface SpinProps extends BaseSpinPorps {\n  type: 'SquareSpin' | 'TreblingCircle' | 'SpinStretch' | 'Dots';\n}\n\nexport const SquareSpin: React.FC<BaseSpinPorps> = props => (\n  <div\n    style={props.style}\n    className={classnames('tea-spin-square', props.className)}\n  />\n);\n\nexport const TreblingCircle: React.FC<BaseSpinPorps> = props => (\n  <div\n    style={props.style}\n    className={classnames('tea-spin-treblingCircle', props.className)}\n  >\n    <div className=\"outer\" />\n    <div className=\"middle\" />\n    <div className=\"inner\" />\n  </div>\n);\n\nexport const SpinStretch: React.FC<BaseSpinPorps> = props => (\n  <div\n    style={props.style}\n    className={classnames('tea-spin-spinStretch', props.className)}\n  />\n);\nexport const Dots: React.FC<BaseSpinPorps> = props => (\n  <div\n    style={props.style}\n    className={classnames('tea-spin-dots', props.className)}\n  >\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n  </div>\n);\n\nexport const Circle: React.FC<BaseSpinPorps> = props => (\n  <svg\n    viewBox=\"25 25 50 50\"\n    style={props.style}\n    className={classnames('tea-spin-circle', props.className)}\n  >\n    <circle cx=\"50\" cy=\"50\" r=\"20\" />\n  </svg>\n);\n","import {\n  useState,\n  useEffect,\n  Dispatch,\n  SetStateAction,\n  DependencyList,\n  EffectCallback,\n  useRef,\n} from 'react';\n\nexport function useEffectState<T>(\n  props: T | (() => T),\n  deps?: DependencyList,\n): [T, Dispatch<SetStateAction<T>>] {\n  const [state, setState] = useState(props);\n  useEffect(() => {\n    setState(props);\n  }, deps);\n  return [state, setState];\n}\n\nexport function useEffectExcludeFirst(\n  effect: EffectCallback,\n  deps?: DependencyList,\n): void {\n  const count = useRef(0);\n  return useEffect(() => {\n    if (!count.current) {\n      count.current += 1;\n    } else return effect();\n  }, deps);\n}\n\nexport function useEffectExcludeNum(\n  effect: EffectCallback,\n  deps?: DependencyList,\n  num = 1,\n): void {\n  const count = useRef(0);\n  return useEffect(() => {\n    if (count.current < num) {\n      count.current += 1;\n    } else return effect();\n  }, deps);\n}\n"],"sourceRoot":""}