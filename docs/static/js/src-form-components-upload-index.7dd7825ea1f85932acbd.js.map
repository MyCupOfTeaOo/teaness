{"version":3,"sources":["D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/index.mdx","D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/context.ts","D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/Registry.ts","D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/decorator.tsx","D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/index.tsx","D:/zouwendi/01projectFiles/teaness/src/Img/index.tsx","D:/zouwendi/01projectFiles/teaness/src/Modal/index.tsx","D:/zouwendi/01projectFiles/teaness/src/Spin/index.tsx","D:/zouwendi/01projectFiles/teaness/src/hooks/index.ts"],"names":["name","layoutProps","MDXLayout","MDXContent","components","props","mdxType","__position","__code","__scope","this","useContext","useMemo","Playground","Props","Button","Upload","UploadContext","Registry","__codesandbox","maxSize","listType","accept","Demo","create","uploadContext","upload","Promise","r","j","setTimeout","onClick","then","res","console","log","of","parentName","isMDXComponent","React","createContext","register","unregister","p","cancel","strokeColor","bind","options","errorBack","WrappedComponent","registry","Set","memo","useState","loadings","setLoadings","visible","setVisible","uploadingPromises","useCallback","ref","add","toUpload","Array","from","length","message","error","resolve","all","map","item","fileList","file","status","percent","prevLoadings","uid","resp","info","uniqueId","push","err","setFileList","prevFileList","target","find","f","reject","lodash","omit","reduce","prev","cur","concat","Modal","title","className","content","forEach","waitSearch","Object","keys","key","unset","onCancel","Provider","value","maskClosable","footer","Img","src","thumbUrl","url","onChange","onSelect","getInfoErrorback","g","getFileInfo","children","loading","rest","context","unmount","isLoading","handle","undefined","split","filter","join","isEmpty","size","useEffect","uids","some","index","isArray","type","temp","values","beforeUpload","onPreview","onDownload","onDownLoad","defaultProps","style","display","alignItems","width","icon","useEffectState","backupSrc","setSrc","alt","onError","AModal","centered","success","confirm","warning","SquareSpin","classnames","TreblingCircle","SpinStretch","Dots","Circle","viewBox","cx","cy","deps","state","setState"],"mappings":"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","file":"static/js/src-form-components-upload-index.8c1b96a3.js","sourcesContent":["\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\n\n/* @jsx mdx */\nimport { useContext, useMemo } from 'react';\nimport { Playground, Props } from 'docz';\nimport { Button } from 'antd';\nimport 'antd/dist/antd.css';\nimport Upload, { UploadContext, Registry } from '.';\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\nconst Demo = makeShortcode(\"Demo\");\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h2 {...{\n      \"id\": \"基本用法basic-usage\"\n    }}>{`基本用法(Basic usage)`}</h2>\n    <p>{`这是一个手动上传的组件,需要先实现 upload 方法全局注册后才可以使用`}</p>\n    <h3 {...{\n      \"id\": \"最简单的上传需要直接上传可以实现-beforeupload-方法\"\n    }}>{`最简单的上传,需要直接上传可以实现 beforeUpload 方法`}</h3>\n    <p>{`继承了 antd upload 的所有属性`}</p>\n    <Playground __position={0} __code={'限制大小\\n<Upload maxSize={1} />\\n展示样式\\n<Upload listType=\\\"picture\\\" />\\n友好的文件提示\\n<Upload accept=\\\"image/*\\\" />'} __scope={{\n      props: this ? this.props : props,\n      useContext,\n      useMemo,\n      Playground,\n      Props,\n      Button,\n      Upload,\n      UploadContext,\n      Registry\n    }} __codesandbox={`undefined`} mdxType=\"Playground\">\n  限制大小\n  <Upload maxSize={1} mdxType=\"Upload\" />\n  展示样式\n  <Upload listType=\"picture\" mdxType=\"Upload\" />\n  友好的文件提示\n  <Upload accept=\"image/*\" mdxType=\"Upload\" />\n    </Playground>\n    <Playground __position={1} __code={'() => {\\n  const Demo = useMemo(\\n    () =>\\n      Upload.create()(() => {\\n        const uploadContext = useContext(UploadContext)\\n        Registry.upload = () => {\\n          return new Promise((r, j) => {\\n            setTimeout(() => j(false), 1000)\\n          })\\n        }\\n        return (\\n          <div>\\n            <Button\\n              onClick={() => {\\n                uploadContext\\n                  .upload()\\n                  .then(res => console.log(`上传成功 ${res}`))\\n              }}\\n            >\\n              手动上传到服务器\\n            </Button>\\n            <Upload listType=\\\"picture\\\" />\\n          </div>\\n        )\\n      }),\\n    [],\\n  )\\n  return <Demo />\\n}'} __scope={{\n      props: this ? this.props : props,\n      useContext,\n      useMemo,\n      Playground,\n      Props,\n      Button,\n      Upload,\n      UploadContext,\n      Registry\n    }} __codesandbox={`undefined`} mdxType=\"Playground\">\n  {() => {\n        const Demo = useMemo(() => Upload.create()(() => {\n          const uploadContext = useContext(UploadContext);\n\n          Registry.upload = () => {\n            return new Promise((r, j) => {\n              setTimeout(() => j(false), 1000);\n            });\n          };\n\n          return <div>\n      <Button onClick={() => {\n              uploadContext.upload().then(res => console.log(`上传成功 ${res}`));\n            }} mdxType=\"Button\">手动上传到服务器</Button>\n      <Upload listType=\"picture\" mdxType=\"Upload\" />\n    </div>;\n        }), []);\n        return <Demo mdxType=\"Demo\" />;\n      }}\n    </Playground>\n    <h2 {...{\n      \"id\": \"属性properties\"\n    }}>{`属性(Properties)`}</h2>\n    <h3 {...{\n      \"id\": \"upload\"\n    }}>{`Upload`}</h3>\n    <Props of={Upload} mdxType=\"Props\" />\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-ts\"\n      }}>{`interface UploadProps extends AntUploadProps {\n  /**\n   * 选择图片后触发\n   */\n  onSelect?: (info: UploadChangeParam) => void;\n  /**\n   * 获取信息失败后的回调\n   */\n  getInfoErrorback?: (uid: string, err: any) => void;\n  /**\n   * 获取信息的方法 一般会先从上下文获取,但是这个优先级更高\n   */\n  getFileInfo?: GetFileInfoType;\n  /**\n   * 加载信息时候展示的样式\n   */\n  loading?: React.ReactNode;\n  /**\n   * 文件最大size 单位KB\n   */\n  maxSize?: number;\n}\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"create\"\n    }}>{`create`}</h3>\n    <Props of={Upload.create} mdxType=\"Props\" />\n    <h2 {...{\n      \"id\": \"全局配置\"\n    }}>{`全局配置`}</h2>\n    <p>{`可以通过 Upload 目录的 Registry 修改`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;","import React from 'react';\nimport { UploadContextType, CancellablePromise } from './typings';\n\nexport const UploadContext = React.createContext<UploadContextType>({\n  register: () => {},\n  unregister: () => {},\n  upload: () => {\n    const p = new Promise(() => {});\n    (p as CancellablePromise<boolean>).cancel = () => {};\n    return p as CancellablePromise<boolean>;\n  },\n});\n","import { UploadFile, onUpload, GetFileInfoType } from './typings';\n\nconst Registry: {\n  onDownLoad?: (file: UploadFile) => void;\n  onPreview?: (file: UploadFile) => void;\n  upload?: onUpload;\n  getFileInfo?: GetFileInfoType;\n} = {};\n\nexport default Registry;\n","import React, { useCallback, useMemo, useState } from 'react';\nimport lodash from 'lodash-es';\nimport { message, Progress } from 'antd';\nimport Modal from '../../../Modal';\nimport { UploadContext } from './context';\nimport {\n  UploadRefType,\n  CancellablePromise,\n  UploadFile,\n  onUpload,\n} from './typings';\nimport Registry from './Registry';\nimport './styles.scss';\nimport Img from '../../../Img';\n\nexport interface OptionsType {\n  errorBack?: (err: any) => void;\n  upload?: onUpload;\n}\n\nconst strokeColor = {\n  '0%': '#108ee9',\n  '100%': '#87d068',\n};\n\nexport const bind = (options: OptionsType = {}) => {\n  const { errorBack } = options;\n  return function<T>(WrappedComponent: React.ComponentType<T>) {\n    return (props: T) => {\n      const registry = useMemo<Set<UploadRefType>>(() => new Set(), []);\n      const memo = useMemo<{\n        [key: string]: string[];\n      }>(() => ({}), []);\n      const [loadings, setLoadings] = useState<{\n        [key: string]: UploadFile;\n      }>({});\n      const [visible, setVisible] = useState(false);\n      const uploadingPromises = useMemo<Set<CancellablePromise<any>>>(\n        () => new Set(),\n        [],\n      );\n\n      const register = useCallback((ref: UploadRefType) => {\n        registry.add(ref);\n      }, []);\n      const unregister = useCallback((ref: UploadRefType) => {\n        registry.delete(ref);\n      }, []);\n\n      const upload = useCallback(() => {\n        const toUpload = options.upload || Registry.upload;\n        const registryArray = Array.from(registry);\n        if (registryArray.length > 0) {\n          if (!toUpload) {\n            message.error('未找到上传方法');\n            const p = Promise.resolve(false);\n            (p as CancellablePromise<boolean>).cancel = () => {};\n            return p as CancellablePromise<boolean>;\n          }\n          const depth = Array.from(registry).map(item => {\n            if (item.fileList) {\n              return item.fileList.map(file => {\n                // 找到需要上传的 后面那个判断只是为了类型推导\n                if (!file.status && file.percent === 0 && toUpload) {\n                  setVisible(true);\n                  setLoadings(prevLoadings => {\n                    return {\n                      ...prevLoadings,\n                      [file.uid]: {\n                        ...file,\n                        status: 'uploading',\n                      },\n                    };\n                  });\n                  const resp = toUpload(file, percent => {\n                    setLoadings(prevLoadings => {\n                      return {\n                        ...prevLoadings,\n                        [file.uid]: {\n                          ...file,\n                          status: percent < 100 ? 'uploading' : 'done',\n                          percent,\n                        },\n                      };\n                    });\n                  });\n                  uploadingPromises.add(resp);\n\n                  resp\n                    .then(info => {\n                      if (!memo[item.uniqueId]) {\n                        memo[item.uniqueId] = [info.uid];\n                      } else {\n                        memo[item.uniqueId].push(info.uid);\n                      }\n                      uploadingPromises.delete(resp);\n                    })\n                    .catch(err => {\n                      // 上传失败的\n                      item.setFileList(prevFileList => {\n                        if (prevFileList) {\n                          const target = prevFileList.find(\n                            f => f.uid === file.uid,\n                          );\n                          if (target) target.status = 'error';\n                          return [...prevFileList];\n                        }\n                        return prevFileList;\n                      });\n                      if (errorBack) errorBack(err);\n                      else console.error(err);\n                      uploadingPromises.delete(resp);\n                      return Promise.reject(err);\n                    })\n                    .finally(() => {\n                      setLoadings(prevLoadings => {\n                        return lodash.omit(prevLoadings, file.uid);\n                      });\n                    });\n                  return resp;\n                }\n                return null;\n              });\n            }\n            return [];\n          });\n          const all = depth.reduce((prev, cur) => {\n            if (cur) return prev.concat(cur);\n            return prev;\n          }, []);\n          const p = Promise.all(all)\n            .then(() => true)\n            .catch(() => false)\n            .then(res => {\n              setVisible(false);\n              if (!res) {\n                Modal.error({\n                  title: '有文件上传失败',\n                  className: 'tea-upload-error-modal',\n                  content: (\n                    <ul className=\"tea-upload-error-list\">\n                      {Array.from(registry)\n                        .reduce<UploadFile[]>((prev, cur) => {\n                          if (cur.fileList) {\n                            cur.fileList.forEach(item => {\n                              if (item.status === 'error') {\n                                prev.push(item);\n                              }\n                            });\n                          }\n                          return prev;\n                        }, [])\n                        .map(item => (\n                          <li title={item.name}>{item.name}</li>\n                        ))}\n                    </ul>\n                  ),\n                });\n              }\n              return res;\n            })\n            .finally(() => {\n              const waitSearch = Array.from(registry);\n              Object.keys(memo).forEach(key => {\n                const target = waitSearch.find(item => item.uniqueId === key);\n                if (target && target.add) {\n                  target.add(memo[key]);\n                }\n                lodash.unset(memo, key);\n              });\n            });\n          (p as CancellablePromise<boolean>).cancel = () => {\n            all.forEach(item => {\n              if (item) item.cancel();\n            });\n          };\n          return p as CancellablePromise<boolean>;\n        } else {\n          const p = Promise.resolve(true);\n          (p as CancellablePromise<boolean>).cancel = () => {};\n          return p as CancellablePromise<boolean>;\n        }\n      }, []);\n      const onCancel = useCallback(() => {\n        setVisible(false);\n        Array.from(uploadingPromises).forEach(item => {\n          item.cancel();\n        });\n      }, []);\n      return (\n        <UploadContext.Provider value={{ register, unregister, upload }}>\n          <Modal\n            className=\"tea-upload-modal\"\n            maskClosable={false}\n            onCancel={onCancel}\n            footer={null}\n            visible={visible}\n          >\n            <ul className=\"tea-upload-modal-body\">\n              {Object.keys(loadings).map(key => (\n                <li>\n                  <Img\n                    className=\"tea-upload-modal-img\"\n                    src={loadings[key].thumbUrl || loadings[key].url}\n                  />\n                  <div className=\"tea-upload-modal-content\">\n                    <span className=\"tea-upload-modal-title\">\n                      {loadings[key].name}\n                    </span>\n                    <Progress\n                      strokeColor={strokeColor}\n                      percent={loadings[key].percent}\n                    />\n                  </div>\n                </li>\n              ))}\n            </ul>\n          </Modal>\n          <WrappedComponent {...props} />\n        </UploadContext.Provider>\n      );\n    };\n  };\n};\n","import React, {\n  useState,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n} from 'react';\nimport { Upload as AntUpload, Button, message } from 'antd';\nimport lodash from 'lodash-es';\nimport { Circle } from '../../../Spin';\nimport { UploadContext } from './context';\nimport {\n  UploadProps,\n  UploadFile,\n  UploadChangeParam,\n  UploadRefType,\n} from './typings';\nimport Registry from './Registry';\nimport { bind } from './decorator';\n\nconst Upload: React.FC<UploadProps> & { create: typeof bind } = props => {\n  const {\n    value,\n    onChange,\n    onSelect,\n    getInfoErrorback,\n    getFileInfo: g,\n    children,\n    loading,\n    maxSize,\n    ...rest\n  } = props;\n  const context = useContext(UploadContext);\n  const memo = useMemo(\n    () => ({\n      unmount: false,\n      uniqueId: lodash.uniqueId('upload'),\n    }),\n    [],\n  );\n  const [loadings, setLoadings] = useState<{ [key: string]: boolean }>({});\n  const isLoading = useMemo(() => Object.keys(loadings).length > 0, [loadings]);\n  const getFileInfo = useMemo(() => g || Registry.getFileInfo, [g]);\n  const [fileList, setFileList] = useState<UploadFile[]>();\n  const handle = useCallback(\n    (info: UploadChangeParam) => {\n      const target = info.fileList.find(item => item.uid === info.file.uid);\n      setFileList(prevFileList => {\n        // 可能是删除的\n        if (!target && prevFileList) {\n          if (onChange) onChange(undefined);\n          return [];\n        }\n        // 这种情况应该不可能\n        if (!target) return prevFileList;\n        // 删除\n        if (target.status === 'removed' && prevFileList) {\n          if (onChange && value) {\n            const fl = value.split(',');\n            const r = fl.filter(item => item === target.uid).join(',');\n            onChange(lodash.isEmpty(r) ? undefined : r);\n          }\n          return prevFileList.filter(item => item.uid !== target.uid);\n        }\n\n        if (maxSize) {\n          if (target.size / 1024 > maxSize) {\n            message.error(`文件最大只能上传${maxSize}KB`);\n            return prevFileList;\n          }\n        }\n        if (prevFileList) {\n          return prevFileList.concat([target]);\n        } else {\n          return [target];\n        }\n      });\n      if (onSelect) onSelect(info);\n    },\n    [onChange],\n  );\n\n  useEffect(() => {\n    let unmount = false;\n    if (value && getFileInfo) {\n      const uids = value.split(',');\n      const all = uids\n        .filter(item => {\n          if (!fileList) return true;\n          return !fileList.some(file => file.uid === item);\n        })\n        .map(uid => {\n          setLoadings(prev => ({\n            ...prev,\n            [uid]: true,\n          }));\n          return getFileInfo(uid);\n        });\n      // 清空\n      setFileList(undefined);\n      all.forEach((resp, index) => {\n        const uid = uids[index];\n        resp\n          .then(item => {\n            if (unmount) return;\n            setFileList(prevFileList => {\n              if (Array.isArray(prevFileList)) {\n                return prevFileList.concat([\n                  {\n                    uid,\n                    size: item.size,\n                    name: item.name,\n                    url: item.url,\n                    type: item.type,\n                    status: 'done',\n                  },\n                ]);\n              } else {\n                return [\n                  {\n                    uid,\n                    size: item.size,\n                    name: item.name,\n                    url: item.url,\n                    type: item.type,\n                    status: 'done',\n                  },\n                ];\n              }\n            });\n          })\n          .catch(err => {\n            if (unmount) return;\n            setFileList(prevFileList => {\n              if (Array.isArray(prevFileList)) {\n                return prevFileList.concat([\n                  {\n                    uid,\n                    name: '文件信息加载失败',\n                    size: 0,\n                    status: 'error',\n                    type: 'null',\n                  },\n                ]);\n              } else {\n                return [\n                  {\n                    uid,\n                    name: '文件信息加载失败',\n                    size: 0,\n                    status: 'error',\n                    type: 'null',\n                  },\n                ];\n              }\n            });\n            if (getInfoErrorback) getInfoErrorback(uid, err);\n            else console.error('文件信息加载失败', err);\n          })\n          .finally(() => {\n            if (!memo.unmount) setLoadings(prev => lodash.omit(prev, uid));\n          });\n      });\n      return () => {\n        unmount = true;\n        all.forEach(item => item.cancel());\n      };\n    }\n  }, [value]);\n  useEffect(() => {\n    return () => {\n      memo.unmount = true;\n    };\n  }, []);\n  useEffect(() => {\n    const temp: UploadRefType = {\n      uniqueId: memo.uniqueId,\n      fileList,\n      setFileList,\n      add: (values: string[]) => {\n        if (props.onChange && values.length > 0) {\n          if (value) {\n            props.onChange(`${value},${values.join(',')}`);\n          } else {\n            props.onChange(values.join(','));\n          }\n        }\n      },\n    };\n    if (context.register) {\n      context.register(temp);\n      return () => {\n        if (context.unregister) {\n          context.unregister(temp);\n        }\n      };\n    }\n  }, [context, fileList, setFileList, value]);\n  const beforeUpload = useCallback(() => false, []);\n  return (\n    <AntUpload\n      onPreview={Registry.onPreview}\n      onDownload={Registry.onDownLoad}\n      beforeUpload={beforeUpload}\n      fileList={fileList}\n      onChange={handle}\n      {...rest}\n    >\n      {isLoading ? loading : children}\n    </AntUpload>\n  );\n};\n\nUpload.defaultProps = {\n  loading: (\n    <div style={{ display: 'flex', alignItems: 'center' }}>\n      <Circle style={{ width: 24 }} />\n      文件信息加载中...\n    </div>\n  ),\n  children: <Button icon=\"upload\">上传</Button>,\n};\n\nUpload.create = bind;\n\nexport { UploadContext, Registry };\nexport default Upload;\n","import React from 'react';\nimport { useEffectState } from '../hooks/index';\n\nexport interface ImgProps {\n  /**\n   * 第一顺位图片\n   */\n  src?: string;\n  /**\n   * 备用图片 默认使用file.svg\n   */\n  backupSrc?: string;\n  alt?: string;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nconst Img: React.FC<ImgProps> = props => {\n  const [src, setSrc] = useEffectState(props.src || props.backupSrc, [\n    props.src,\n  ]);\n  return (\n    <img\n      className={props.className}\n      style={props.style}\n      alt={props.alt}\n      src={src}\n      onError={() => setSrc(props.backupSrc)}\n    />\n  );\n};\nImg.defaultProps = {\n  backupSrc:\n    'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+CiAgPHBhdGggZmlsbD0iI0Q5RDlEOSIgZD0iTTUzNCAzNTJWMTM2SDIzMnY3NTJoNTYwVjM5NEg1NzZhNDIgNDIgMCAwIDEtNDItNDJ6Ii8+CiAgPHBhdGggZD0iTTg1NC42IDI4OC42TDYzOS40IDczLjRjLTYtNi0xNC4xLTkuNC0yMi42LTkuNEgxOTJjLTE3LjcgMC0zMiAxNC4zLTMyIDMydjgzMmMwIDE3LjcgMTQuMyAzMiAzMiAzMmg2NDBjMTcuNyAwIDMyLTE0LjMgMzItMzJWMzExLjNjMC04LjUtMy40LTE2LjctOS40LTIyLjd6TTYwMiAxMzcuOEw3OTAuMiAzMjZINjAyVjEzNy44ek03OTIgODg4SDIzMlYxMzZoMzAydjIxNmE0MiA0MiAwIDAgMCA0MiA0MmgyMTZ2NDk0eiIvPgo8L3N2Zz4K',\n};\nexport default Img;\n","import { Modal as AModal } from 'antd';\nimport { ModalProps } from 'antd/lib/modal';\n\nclass Modal extends AModal {\n  constructor(props: ModalProps, context: {}) {\n    super(props, context);\n  }\n}\n\nModal.error = props => AModal.error({ centered: true, ...props });\nModal.success = props => AModal.success({ centered: true, ...props });\nModal.confirm = props => AModal.confirm({ centered: true, ...props });\nModal.warning = props => AModal.confirm({ centered: true, ...props });\nexport default Modal;\n","import React, { CSSProperties } from 'react';\nimport classnames from 'classnames';\nimport './index.scss';\n\nexport interface BaseSpinPorps {\n  className?: string;\n  style?: CSSProperties;\n}\n\nexport interface SpinProps extends BaseSpinPorps {\n  type: 'SquareSpin' | 'TreblingCircle' | 'SpinStretch' | 'Dots';\n}\n\nexport const SquareSpin: React.FC<BaseSpinPorps> = props => (\n  <div\n    style={props.style}\n    className={classnames('tea-spin-square', props.className)}\n  />\n);\n\nexport const TreblingCircle: React.FC<BaseSpinPorps> = props => (\n  <div\n    style={props.style}\n    className={classnames('tea-spin-treblingCircle', props.className)}\n  >\n    <div className=\"outer\" />\n    <div className=\"middle\" />\n    <div className=\"inner\" />\n  </div>\n);\n\nexport const SpinStretch: React.FC<BaseSpinPorps> = props => (\n  <div\n    style={props.style}\n    className={classnames('tea-spin-spinStretch', props.className)}\n  />\n);\nexport const Dots: React.FC<BaseSpinPorps> = props => (\n  <div\n    style={props.style}\n    className={classnames('tea-spin-dots', props.className)}\n  >\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n  </div>\n);\n\nexport const Circle: React.FC<BaseSpinPorps> = props => (\n  <svg\n    viewBox=\"25 25 50 50\"\n    style={props.style}\n    className={classnames('tea-spin-circle', props.className)}\n  >\n    <circle cx=\"50\" cy=\"50\" r=\"20\" />\n  </svg>\n);\n","import {\n  useState,\n  useEffect,\n  Dispatch,\n  SetStateAction,\n  DependencyList,\n} from 'react';\n\nexport function useEffectState<T>(\n  props: T | (() => T),\n  deps?: DependencyList,\n): [T, Dispatch<SetStateAction<T>>] {\n  const [state, setState] = useState(props);\n  useEffect(() => {\n    setState(props);\n  }, deps);\n  return [state, setState];\n}\n"],"sourceRoot":""}