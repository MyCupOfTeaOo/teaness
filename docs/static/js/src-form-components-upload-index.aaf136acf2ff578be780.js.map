{"version":3,"sources":["D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/index.mdx","D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/context.ts","D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/Registry.ts","D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/decorator.tsx","D:/zouwendi/01projectFiles/teaness/src/Form/Components/Upload/index.tsx","D:/zouwendi/01projectFiles/teaness/src/Img/index.tsx","D:/zouwendi/01projectFiles/teaness/src/Modal/index.tsx","D:/zouwendi/01projectFiles/teaness/src/Spin/index.tsx","D:/zouwendi/01projectFiles/teaness/src/hooks/index.ts"],"names":["name","layoutProps","MDXLayout","MDXContent","components","props","mdxType","__position","__code","__scope","this","useContext","useMemo","Playground","Props","Button","Upload","UploadContext","Registry","__codesandbox","listType","Demo","create","uploadContext","upload","Promise","r","j","setTimeout","onClick","then","res","console","log","of","isMDXComponent","React","createContext","register","unregister","p","cancel","strokeColor","bind","options","errorBack","WrappedComponent","registry","Set","memo","useState","loadings","setLoadings","visible","setVisible","uploadingPromises","useCallback","ref","add","Array","from","length","message","error","resolve","all","map","item","fileList","file","status","percent","prevLoadings","uid","resp","info","uniqueId","push","err","setFileList","prevFileList","target","find","f","reject","lodash","omit","reduce","prev","cur","concat","Modal","title","className","content","forEach","waitSearch","Object","keys","key","unset","onCancel","Provider","value","maskClosable","footer","Img","src","thumbUrl","url","onChange","onSelect","getInfoErrorback","g","getFileInfo","children","loading","rest","context","unmount","isLoading","handle","filter","useEffect","uids","split","undefined","index","isArray","size","type","temp","values","join","beforeUpload","onPreview","onDownload","onDownLoad","defaultProps","style","display","alignItems","width","icon","useEffectState","backupSrc","setSrc","alt","onError","AModal","centered","success","confirm","warning","SquareSpin","classnames","TreblingCircle","SpinStretch","Dots","Circle","viewBox","cx","cy","deps","state","setState"],"mappings":"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","file":"static/js/src-form-components-upload-index.efef803f.js","sourcesContent":["\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\n\n/* @jsx mdx */\nimport { useContext, useMemo } from 'react';\nimport { Playground, Props } from 'docz';\nimport { Button } from 'antd';\nimport 'antd/dist/antd.css';\nimport Upload, { UploadContext, Registry } from '.';\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\nconst Demo = makeShortcode(\"Demo\");\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h2 {...{\n      \"id\": \"基本用法basic-usage\"\n    }}>{`基本用法(Basic usage)`}</h2>\n    <p>{`这是一个手动上传的组件,需要先实现 upload 方法全局注册后才可以使用`}</p>\n    <h3 {...{\n      \"id\": \"最简单的上传需要直接上传可以实现-beforeupload-方法\"\n    }}>{`最简单的上传,需要直接上传可以实现 beforeUpload 方法`}</h3>\n    <p>{`继承了 antd upload 的所有属性`}</p>\n    <Playground __position={0} __code={'<Upload />\\n<Upload listType=\\\"picture\\\" />'} __scope={{\n      props: this ? this.props : props,\n      useContext,\n      useMemo,\n      Playground,\n      Props,\n      Button,\n      Upload,\n      UploadContext,\n      Registry\n    }} __codesandbox={`undefined`} mdxType=\"Playground\">\n  <Upload mdxType=\"Upload\" />\n  <Upload listType=\"picture\" mdxType=\"Upload\" />\n    </Playground>\n    <Playground __position={1} __code={'() => {\\n  const Demo = useMemo(\\n    () =>\\n      Upload.create()(() => {\\n        const uploadContext = useContext(UploadContext)\\n        Registry.upload = () => {\\n          return new Promise((r, j) => {\\n            setTimeout(() => j(false), 1000)\\n          })\\n        }\\n        return (\\n          <div>\\n            <Button\\n              onClick={() => {\\n                uploadContext\\n                  .upload()\\n                  .then(res => console.log(`上传成功 ${res}`))\\n              }}\\n            >\\n              手动上传到服务器\\n            </Button>\\n            <Upload listType=\\\"picture\\\" />\\n          </div>\\n        )\\n      }),\\n    [],\\n  )\\n  return <Demo />\\n}'} __scope={{\n      props: this ? this.props : props,\n      useContext,\n      useMemo,\n      Playground,\n      Props,\n      Button,\n      Upload,\n      UploadContext,\n      Registry\n    }} __codesandbox={`undefined`} mdxType=\"Playground\">\n  {() => {\n        const Demo = useMemo(() => Upload.create()(() => {\n          const uploadContext = useContext(UploadContext);\n\n          Registry.upload = () => {\n            return new Promise((r, j) => {\n              setTimeout(() => j(false), 1000);\n            });\n          };\n\n          return <div>\n      <Button onClick={() => {\n              uploadContext.upload().then(res => console.log(`上传成功 ${res}`));\n            }} mdxType=\"Button\">手动上传到服务器</Button>\n      <Upload listType=\"picture\" mdxType=\"Upload\" />\n    </div>;\n        }), []);\n        return <Demo mdxType=\"Demo\" />;\n      }}\n    </Playground>\n    <h2 {...{\n      \"id\": \"全局配置\"\n    }}>{`全局配置`}</h2>\n    <p>{`可以通过 Upload 目录的 Registry 修改`}</p>\n    <h2 {...{\n      \"id\": \"属性properties\"\n    }}>{`属性(Properties)`}</h2>\n    <h3 {...{\n      \"id\": \"upload\"\n    }}>{`Upload`}</h3>\n    <Props of={Upload} mdxType=\"Props\" />\n    <h3 {...{\n      \"id\": \"create\"\n    }}>{`create`}</h3>\n    <Props of={Upload.create} mdxType=\"Props\" />\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;","import React from 'react';\nimport { UploadContextType, CancellablePromise } from './typings';\n\nexport const UploadContext = React.createContext<UploadContextType>({\n  register: () => {},\n  unregister: () => {},\n  upload: () => {\n    const p = new Promise(() => {});\n    (p as CancellablePromise<boolean>).cancel = () => {};\n    return p as CancellablePromise<boolean>;\n  },\n});\n","import { UploadFile, onUpload, GetFileInfoType } from './typings';\n\nconst Registry: {\n  onDownLoad?: (file: UploadFile) => void;\n  onPreview?: (file: UploadFile) => void;\n  upload?: onUpload;\n  getFileInfo?: GetFileInfoType;\n} = {};\n\nexport default Registry;\n","import React, { useCallback, useMemo, useState } from 'react';\nimport lodash from 'lodash-es';\nimport { message, Progress } from 'antd';\nimport Modal from '../../../Modal';\nimport { UploadContext } from './context';\nimport { UploadRefType, CancellablePromise, UploadFile } from './typings';\nimport Registry from './Registry';\nimport './styles.scss';\nimport Img from '../../../Img';\n\nexport interface OptionsType {\n  errorBack?: (err: any) => void;\n}\n\nconst strokeColor = {\n  '0%': '#108ee9',\n  '100%': '#87d068',\n};\n\nexport const bind = (options: OptionsType = {}) => {\n  const { errorBack } = options;\n  return function<T>(WrappedComponent: React.ComponentType<T>) {\n    return (props: T) => {\n      const registry = useMemo<Set<UploadRefType>>(() => new Set(), []);\n      const memo = useMemo<{\n        [key: string]: string[];\n      }>(() => ({}), []);\n      const [loadings, setLoadings] = useState<{\n        [key: string]: UploadFile;\n      }>({});\n      const [visible, setVisible] = useState(false);\n      const uploadingPromises = useMemo<Set<CancellablePromise<any>>>(\n        () => new Set(),\n        [],\n      );\n\n      const register = useCallback((ref: UploadRefType) => {\n        registry.add(ref);\n      }, []);\n      const unregister = useCallback((ref: UploadRefType) => {\n        registry.delete(ref);\n      }, []);\n\n      const upload = useCallback(() => {\n        const registryArray = Array.from(registry);\n        if (registryArray.length > 0) {\n          if (!Registry.upload) {\n            message.error('未找到上传方法');\n            const p = Promise.resolve(false);\n            (p as CancellablePromise<boolean>).cancel = () => {};\n            return p as CancellablePromise<boolean>;\n          }\n          const depth = Array.from(registry).map(item => {\n            if (item.fileList) {\n              return item.fileList.map(file => {\n                // 找到需要上传的 后面那个判断只是为了类型推导\n                if (!file.status && file.percent === 0 && Registry.upload) {\n                  setVisible(true);\n                  setLoadings(prevLoadings => {\n                    return {\n                      ...prevLoadings,\n                      [file.uid]: {\n                        ...file,\n                        status: 'uploading',\n                      },\n                    };\n                  });\n                  const resp = Registry.upload(file, percent => {\n                    setLoadings(prevLoadings => {\n                      return {\n                        ...prevLoadings,\n                        [file.uid]: {\n                          ...file,\n                          status: percent < 100 ? 'uploading' : 'done',\n                          percent,\n                        },\n                      };\n                    });\n                  });\n                  uploadingPromises.add(resp);\n\n                  resp\n                    .then(info => {\n                      if (!memo[item.uniqueId]) {\n                        memo[item.uniqueId] = [info.uid];\n                      } else {\n                        memo[item.uniqueId].push(info.uid);\n                      }\n                      uploadingPromises.delete(resp);\n                    })\n                    .catch(err => {\n                      // 上传失败的\n                      item.setFileList(prevFileList => {\n                        if (prevFileList) {\n                          const target = prevFileList.find(\n                            f => f.uid === file.uid,\n                          );\n                          if (target) target.status = 'error';\n                          return [...prevFileList];\n                        }\n                        return prevFileList;\n                      });\n                      if (errorBack) errorBack(err);\n                      else console.error(err);\n                      uploadingPromises.delete(resp);\n                      return Promise.reject(err);\n                    })\n                    .finally(() => {\n                      setLoadings(prevLoadings => {\n                        return lodash.omit(prevLoadings, file.uid);\n                      });\n                    });\n                  return resp;\n                }\n                return null;\n              });\n            }\n            return [];\n          });\n          const all = depth.reduce((prev, cur) => {\n            if (cur) return prev.concat(cur);\n            return prev;\n          }, []);\n          const p = Promise.all(all)\n            .then(() => true)\n            .catch(() => false)\n            .then(res => {\n              setVisible(false);\n              if (!res) {\n                Modal.error({\n                  title: '有文件上传失败',\n                  className: 'tea-upload-error-modal',\n                  content: (\n                    <ul className=\"tea-upload-error-list\">\n                      {Array.from(registry)\n                        .reduce<UploadFile[]>((prev, cur) => {\n                          if (cur.fileList) {\n                            cur.fileList.forEach(item => {\n                              if (item.status === 'error') {\n                                prev.push(item);\n                              }\n                            });\n                          }\n                          return prev;\n                        }, [])\n                        .map(item => (\n                          <li title={item.name}>{item.name}</li>\n                        ))}\n                    </ul>\n                  ),\n                });\n              }\n              return res;\n            })\n            .finally(() => {\n              const waitSearch = Array.from(registry);\n              Object.keys(memo).forEach(key => {\n                const target = waitSearch.find(item => item.uniqueId === key);\n                if (target && target.add) {\n                  target.add(memo[key]);\n                }\n                lodash.unset(memo, key);\n              });\n            });\n          (p as CancellablePromise<boolean>).cancel = () => {\n            all.forEach(item => {\n              if (item) item.cancel();\n            });\n          };\n          return p as CancellablePromise<boolean>;\n        } else {\n          const p = Promise.resolve(true);\n          (p as CancellablePromise<boolean>).cancel = () => {};\n          return p as CancellablePromise<boolean>;\n        }\n      }, []);\n      const onCancel = useCallback(() => {\n        setVisible(false);\n        Array.from(uploadingPromises).forEach(item => {\n          item.cancel();\n        });\n      }, []);\n      return (\n        <UploadContext.Provider value={{ register, unregister, upload }}>\n          <Modal\n            className=\"tea-upload-modal\"\n            maskClosable={false}\n            onCancel={onCancel}\n            footer={null}\n            visible={visible}\n          >\n            <ul className=\"tea-upload-modal-body\">\n              {Object.keys(loadings).map(key => (\n                <li>\n                  <Img\n                    className=\"tea-upload-modal-img\"\n                    src={loadings[key].thumbUrl || loadings[key].url}\n                  />\n                  <div className=\"tea-upload-modal-content\">\n                    <span className=\"tea-upload-modal-title\">{loadings[key].name}</span>\n                    <Progress\n                      strokeColor={strokeColor}\n                      percent={loadings[key].percent}\n                    />\n                  </div>\n                </li>\n              ))}\n            </ul>\n          </Modal>\n          <WrappedComponent {...props} />\n        </UploadContext.Provider>\n      );\n    };\n  };\n};\n","import React, {\n  useState,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n} from 'react';\nimport { Upload as AntUpload, Button } from 'antd';\nimport lodash from 'lodash-es';\nimport { Circle } from '../../../Spin';\nimport { UploadContext } from './context';\nimport {\n  UploadProps,\n  UploadFile,\n  UploadChangeParam,\n  UploadRefType,\n} from './typings';\nimport Registry from './Registry';\nimport { bind } from './decorator';\n\nconst Upload: React.FC<UploadProps> & { create: typeof bind } = props => {\n  const {\n    value,\n    onChange,\n    onSelect,\n    getInfoErrorback,\n    getFileInfo: g,\n    children,\n    loading,\n    ...rest\n  } = props;\n  const context = useContext(UploadContext);\n  const memo = useMemo(\n    () => ({\n      unmount: false,\n      uniqueId: lodash.uniqueId('upload'),\n    }),\n    [],\n  );\n  const [loadings, setLoadings] = useState<{ [key: string]: boolean }>({});\n  const isLoading = useMemo(() => Object.keys(loadings).length > 0, [loadings]);\n  const getFileInfo = useMemo(() => g || Registry.getFileInfo, [g]);\n  const [fileList, setFileList] = useState<UploadFile[]>();\n  const handle = useCallback(\n    (info: UploadChangeParam) => {\n      const target = info.fileList.find(item => item.uid === info.file.uid);\n      setFileList(prevFileList => {\n        // 可能是删除的\n        if (!target && prevFileList) return prevFileList.filter(item => item.uid !== info.file.uid);\n        // 这种情况应该不可能\n        if (!target) return prevFileList;\n        if (prevFileList) {\n          if (target.status === 'removed') {\n            return prevFileList.filter(item => item.uid !== target.uid);\n          }\n          return prevFileList.concat([target]);\n        } else {\n          return [target];\n        }\n      });\n      if (onSelect) onSelect(info);\n    },\n    [onChange],\n  );\n\n  useEffect(() => {\n    let unmount = false;\n    if (value && getFileInfo) {\n      const uids = value.split(',');\n      const all = uids.map(uid => {\n        setLoadings(prev => ({\n          ...prev,\n          [uid]: true,\n        }));\n        return getFileInfo(uid);\n      });\n      // 清空\n      setFileList(undefined);\n      all.forEach((resp, index) => {\n        const uid = uids[index];\n        resp\n          .then(item => {\n            if (unmount) return;\n            setFileList(prevFileList => {\n              if (Array.isArray(prevFileList)) {\n                return prevFileList.concat([\n                  {\n                    uid,\n                    size: item.size,\n                    name: item.name,\n                    url: item.url,\n                    type: item.type,\n                    status: 'done',\n                  },\n                ]);\n              } else {\n                return [\n                  {\n                    uid,\n                    size: item.size,\n                    name: item.name,\n                    url: item.url,\n                    type: item.type,\n                    status: 'done',\n                  },\n                ];\n              }\n            });\n          })\n          .catch(err => {\n            if (unmount) return;\n            setFileList(prevFileList => {\n              if (Array.isArray(prevFileList)) {\n                return prevFileList.concat([\n                  {\n                    uid,\n                    name: '文件信息加载失败',\n                    size: 0,\n                    status: 'error',\n                    type: 'null',\n                  },\n                ]);\n              } else {\n                return [\n                  {\n                    uid,\n                    name: '文件信息加载失败',\n                    size: 0,\n                    status: 'error',\n                    type: 'null',\n                  },\n                ];\n              }\n            });\n            if (getInfoErrorback) getInfoErrorback(uid, err);\n            else console.error('文件信息加载失败', err);\n          })\n          .finally(() => {\n            if (!memo.unmount) setLoadings(prev => lodash.omit(prev, uid));\n          });\n      });\n      return () => {\n        unmount = true;\n        all.forEach(item => item.cancel());\n      };\n    }\n  }, [value]);\n  useEffect(() => {\n    return () => {\n      memo.unmount = true;\n    };\n  }, []);\n  useEffect(() => {\n    const temp: UploadRefType = {\n      uniqueId: memo.uniqueId,\n      fileList,\n      setFileList,\n      add: (values: string[]) => {\n        if (props.onChange && values.length > 0) {\n          if (value) {\n            props.onChange(`${value},${values.join(',')}`);\n          } else {\n            props.onChange(values.join(','));\n          }\n        }\n      },\n    };\n    if (context.register) {\n      context.register(temp);\n      return () => {\n        if (context.unregister) {\n          context.unregister(temp);\n        }\n      };\n    }\n  }, [context, fileList, setFileList, value]);\n  const beforeUpload = useCallback(() => false, []);\n  return (\n    <AntUpload\n      onPreview={Registry.onPreview}\n      onDownload={Registry.onDownLoad}\n      beforeUpload={beforeUpload}\n      fileList={fileList}\n      onChange={handle}\n      {...rest}\n    >\n      {isLoading ? loading : children}\n    </AntUpload>\n  );\n};\n\nUpload.defaultProps = {\n  loading: (\n    <div style={{ display: 'flex', alignItems: 'center' }}>\n      <Circle style={{ width: 24 }} />\n      文件信息加载中...\n    </div>\n  ),\n  children: <Button icon=\"upload\">上传</Button>,\n};\n\nUpload.create = bind;\n\nexport { UploadContext, Registry };\nexport default Upload;\n","import React from 'react';\nimport { useEffectState } from '../hooks/index';\n\nexport interface ImgProps {\n  /**\n   * 第一顺位图片\n   */\n  src?: string;\n  /**\n   * 备用图片 默认使用file.svg\n   */\n  backupSrc?: string;\n  alt?: string;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nconst Img: React.FC<ImgProps> = props => {\n  const [src, setSrc] = useEffectState(props.src || props.backupSrc, [\n    props.src,\n  ]);\n  return (\n    <img\n      className={props.className}\n      style={props.style}\n      alt={props.alt}\n      src={src}\n      onError={() => setSrc(props.backupSrc)}\n    />\n  );\n};\nImg.defaultProps = {\n  backupSrc:\n    'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+CiAgPHBhdGggZmlsbD0iI0Q5RDlEOSIgZD0iTTUzNCAzNTJWMTM2SDIzMnY3NTJoNTYwVjM5NEg1NzZhNDIgNDIgMCAwIDEtNDItNDJ6Ii8+CiAgPHBhdGggZD0iTTg1NC42IDI4OC42TDYzOS40IDczLjRjLTYtNi0xNC4xLTkuNC0yMi42LTkuNEgxOTJjLTE3LjcgMC0zMiAxNC4zLTMyIDMydjgzMmMwIDE3LjcgMTQuMyAzMiAzMiAzMmg2NDBjMTcuNyAwIDMyLTE0LjMgMzItMzJWMzExLjNjMC04LjUtMy40LTE2LjctOS40LTIyLjd6TTYwMiAxMzcuOEw3OTAuMiAzMjZINjAyVjEzNy44ek03OTIgODg4SDIzMlYxMzZoMzAydjIxNmE0MiA0MiAwIDAgMCA0MiA0MmgyMTZ2NDk0eiIvPgo8L3N2Zz4K',\n};\nexport default Img;\n","import { Modal as AModal } from 'antd';\nimport { ModalProps } from 'antd/lib/modal';\n\nclass Modal extends AModal {\n  constructor(props: ModalProps, context: {}) {\n    super(props, context);\n  }\n}\n\nModal.error = props => AModal.error({ centered: true, ...props });\nModal.success = props => AModal.success({ centered: true, ...props });\nModal.confirm = props => AModal.confirm({ centered: true, ...props });\nModal.warning = props => AModal.confirm({ centered: true, ...props });\nexport default Modal;\n","import React, { CSSProperties } from 'react';\nimport classnames from 'classnames';\nimport './index.scss';\n\nexport interface BaseSpinPorps {\n  className?: string;\n  style?: CSSProperties;\n}\n\nexport interface SpinProps extends BaseSpinPorps {\n  type: 'SquareSpin' | 'TreblingCircle' | 'SpinStretch' | 'Dots';\n}\n\nexport const SquareSpin: React.FC<BaseSpinPorps> = props => (\n  <div\n    style={props.style}\n    className={classnames('tea-spin-square', props.className)}\n  />\n);\n\nexport const TreblingCircle: React.FC<BaseSpinPorps> = props => (\n  <div\n    style={props.style}\n    className={classnames('tea-spin-treblingCircle', props.className)}\n  >\n    <div className=\"outer\" />\n    <div className=\"middle\" />\n    <div className=\"inner\" />\n  </div>\n);\n\nexport const SpinStretch: React.FC<BaseSpinPorps> = props => (\n  <div\n    style={props.style}\n    className={classnames('tea-spin-spinStretch', props.className)}\n  />\n);\nexport const Dots: React.FC<BaseSpinPorps> = props => (\n  <div\n    style={props.style}\n    className={classnames('tea-spin-dots', props.className)}\n  >\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n    <div />\n  </div>\n);\n\nexport const Circle: React.FC<BaseSpinPorps> = props => (\n  <svg\n    viewBox=\"25 25 50 50\"\n    style={props.style}\n    className={classnames('tea-spin-circle', props.className)}\n  >\n    <circle cx=\"50\" cy=\"50\" r=\"20\" />\n  </svg>\n);\n","import {\n  useState,\n  useEffect,\n  Dispatch,\n  SetStateAction,\n  DependencyList,\n} from 'react';\n\nexport function useEffectState<T>(\n  props: T | (() => T),\n  deps?: DependencyList,\n): [T, Dispatch<SetStateAction<T>>] {\n  const [state, setState] = useState(props);\n  useEffect(() => {\n    setState(props);\n  }, deps);\n  return [state, setState];\n}\n"],"sourceRoot":""}