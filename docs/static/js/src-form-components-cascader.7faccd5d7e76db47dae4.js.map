{"version":3,"sources":["D:/zouwendi/01projectFiles/teaness/src/Form/Components/Cascader.tsx","D:/zouwendi/01projectFiles/teaness/src/Form/Components/Cascader.mdx"],"names":["Cascader","props","onChange","defaultOptions","options","requestMethod","errorCallback","className","value","separator","otherProps","unListions","useMemo","Set","useState","setOptions","isChange","setIsChange","loadData","useCallback","selectedOptions","targetOption","length","loading","p","add","then","resp","children","prevOptions","error","console","split","reduce","prevValues","curValue","push","undefined","useEffect","Array","from","forEach","cp","cancel","isArray","depthLoad","i","find","item","handle","v","classnames","defaultProps","layoutProps","MDXLayout","MDXContent","components","mdxType","parentName","__position","__code","__scope","this","Playground","Props","__codesandbox","setValue","label","isLeaf","of","isMDXComponent"],"mappings":"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","file":"static/js/src-form-components-cascader.b8e93ca6.js","sourcesContent":["import React, {\n  useState,\n  useCallback,\n  useMemo,\n  useEffect,\n  Dispatch,\n  SetStateAction,\n} from 'react';\nimport { Cascader as AntCascader } from 'antd';\nimport classnames from 'classnames';\nimport {\n  CascaderProps as AntCascaderProps,\n  CascaderOptionType,\n} from 'antd/lib/cascader';\nimport './styles/cascader.scss';\n\nexport type CancellablePromise<T> = Promise<T> & {\n  cancel(): void;\n};\n\nexport interface CascaderProps\n  extends Omit<AntCascaderProps, 'options' | 'value' | 'onChange'> {\n  requestMethod?: (\n    fatherCode?: string,\n  ) => CancellablePromise<CascaderOptionType[]>;\n  /** 可选项数据源 */\n  options?: CascaderOptionType[];\n  value?: string;\n  errorCallback?: (error: any, target?: CascaderOptionType[] | string) => void;\n  onChange?: (\n    value: string | undefined,\n    selectedOptions?: CascaderOptionType[],\n  ) => void;\n  separator?: string;\n}\n\nconst depthLoad = (\n  i: number,\n  value: string[],\n  unListions: Set<CancellablePromise<CascaderOptionType[]>>,\n  requestMethod: (\n    fatherCode?: string,\n  ) => CancellablePromise<CascaderOptionType[]>,\n  setOptions: Dispatch<SetStateAction<CascaderOptionType[] | undefined>>,\n  errorCallback: any,\n  options?: CascaderOptionType[],\n) => {\n  if (options && value.length > i) {\n    const curValue = value[i - 1];\n    const targetOption = options.find(item => item.value === curValue);\n    if (targetOption) {\n      // 已经加载\n      if (targetOption.children) {\n        depthLoad(\n          i + 1,\n          value,\n          unListions,\n          requestMethod,\n          setOptions,\n          errorCallback,\n          targetOption.children,\n        );\n      } else {\n        // 还没有加载\n        const p = requestMethod(curValue);\n        unListions.add(p);\n        p.then(resp => {\n          targetOption.loading = false;\n          targetOption.children = resp;\n          setOptions(prevOptions => {\n            if (prevOptions) return [...prevOptions];\n          });\n        })\n          .catch(error => {\n            if (errorCallback) {\n              errorCallback(error, curValue);\n            } else console.error(error);\n          })\n          .finally(() => {\n            unListions.delete(p);\n          });\n      }\n    }\n  }\n};\n\nconst Cascader: React.FC<CascaderProps> = props => {\n  const {\n    onChange,\n    options: defaultOptions,\n    requestMethod,\n    errorCallback,\n    value: source,\n    className,\n    separator,\n    ...otherProps\n  } = props;\n  const unListions = useMemo<Set<CancellablePromise<CascaderOptionType[]>>>(\n    () => new Set(),\n    [],\n  );\n  const [options, setOptions] = useState(defaultOptions);\n  const [isChange, setIsChange] = useState(false);\n  const loadData = useCallback(\n    (selectedOptions?: CascaderOptionType[]) => {\n      if (selectedOptions) {\n        const targetOption = selectedOptions[selectedOptions.length - 1];\n        targetOption.loading = true;\n        if (requestMethod) {\n          const p = requestMethod(targetOption.value);\n          unListions.add(p);\n          p.then(resp => {\n            targetOption.loading = false;\n            targetOption.children = resp;\n            setOptions(prevOptions => {\n              if (prevOptions) return [...prevOptions];\n            });\n          })\n            .catch(error => {\n              if (errorCallback) {\n                errorCallback(error, selectedOptions);\n              } else console.error(error);\n            })\n            .finally(() => {\n              unListions.delete(p);\n            });\n        }\n      }\n    },\n    [requestMethod],\n  );\n\n  const value = useMemo<string[] | undefined>(\n    () =>\n      (props.value\n        ? props.value\n            .split(separator || '-')\n            .reduce<string[]>((prevValues, curValue) => {\n              if (prevValues.length > 0) {\n                prevValues.push(\n                  `${prevValues[prevValues.length - 1]}${separator ||\n                    '-'}${curValue}`,\n                );\n              } else {\n                prevValues.push(curValue);\n              }\n              return prevValues;\n            }, [])\n        : undefined),\n    [props.value],\n  );\n  useEffect(() => {\n    if (requestMethod) {\n      const p = requestMethod();\n      unListions.add(p);\n      p.then(resp => setOptions(resp))\n        .catch(error => {\n          if (errorCallback) {\n            errorCallback(error);\n          } else console.error(error);\n        })\n        .finally(() => {\n          unListions.delete(p);\n        });\n    }\n    return () => {\n      Array.from(unListions).forEach(cp => {\n        cp.cancel();\n      });\n    };\n  }, [requestMethod]);\n\n  useEffect(() => {\n    if (!isChange && requestMethod) {\n      if (options && Array.isArray(value) && value.length > 1) {\n        depthLoad(\n          1,\n          value,\n          unListions,\n          requestMethod,\n          setOptions,\n          errorCallback,\n          options,\n        );\n      }\n    }\n  }, [options, value]);\n\n  const handle = useCallback(\n    (v: string[], selectedOptions?: CascaderOptionType[]) => {\n      setIsChange(true);\n      if (onChange) {\n        if (v.length > 0) {\n          onChange(v[v.length - 1], selectedOptions);\n        } else {\n          onChange(undefined, selectedOptions);\n        }\n      }\n    },\n    [onChange],\n  );\n\n  return (\n    <AntCascader\n      className={classnames('tea-cascader', className)}\n      value={value ?? undefined}\n      onChange={handle}\n      options={options}\n      loadData={loadData}\n      {...otherProps}\n    />\n  );\n};\n\nCascader.defaultProps = {\n  separator: '-',\n};\n\nexport default Cascader;\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\n\n/* @jsx mdx */\nimport { Playground, Props } from 'docz';\nimport { useState } from 'react';\nimport 'antd/dist/antd.css';\nimport Cascader from './Cascader';\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"cascader选择器\"\n    }}>{`Cascader(选择器)`}</h1>\n    <p>{`antd `}<a parentName=\"p\" {...{\n        \"href\": \"https://ant.design/components/Cascader-cn/\"\n      }}>{`Cascader`}</a>{` 差不多`}</p>\n    <h2 {...{\n      \"id\": \"基本用法basic-usage\"\n    }}>{`基本用法(Basic usage)`}</h2>\n    <Playground __position={0} __code={'() => {\\n  const [value, setValue] = useState(undefined)\\n  return (\\n    <div>\\n      <Cascader\\n        onChange={setValue}\\n        value={value}\\n        options={[\\n          {\\n            label: \\'江苏省\\',\\n            value: \\'32\\',\\n            isLeaf: false,\\n            children: [\\n              {\\n                label: \\'南京市\\',\\n                value: \\'32-01\\',\\n                isLeaf: false,\\n                children: [\\n                  {\\n                    label: \\'市辖区\\',\\n                    value: \\'32-01-01\\',\\n                    isLeaf: true,\\n                  },\\n                ],\\n              },\\n            ],\\n          },\\n          {\\n            label: \\'广西省\\',\\n            value: \\'54\\',\\n            isLeaf: false,\\n            children: [\\n              {\\n                label: \\'柳州市\\',\\n                value: \\'54-50\\',\\n                isLeaf: false,\\n                children: [\\n                  {\\n                    label: \\'城中区\\',\\n                    value: \\'54-50-00\\',\\n                    isLeaf: true,\\n                  },\\n                ],\\n              },\\n            ],\\n          },\\n        ]}\\n      />\\n    </div>\\n  )\\n}'} __scope={{\n      props: this ? this.props : props,\n      Playground,\n      Props,\n      useState,\n      Cascader\n    }} __codesandbox={`undefined`} mdxType=\"Playground\">\n  {() => {\n        const [value, setValue] = useState(undefined);\n        return <div>\n        <Cascader onChange={setValue} value={value} options={[{\n            label: '江苏省',\n            value: '32',\n            isLeaf: false,\n            children: [{\n              label: '南京市',\n              value: '32-01',\n              isLeaf: false,\n              children: [{\n                label: '市辖区',\n                value: '32-01-01',\n                isLeaf: true\n              }]\n            }]\n          }, {\n            label: '广西省',\n            value: '54',\n            isLeaf: false,\n            children: [{\n              label: '柳州市',\n              value: '54-50',\n              isLeaf: false,\n              children: [{\n                label: '城中区',\n                value: '54-50-00',\n                isLeaf: true\n              }]\n            }]\n          }]} mdxType=\"Cascader\" />\n      </div>;\n      }}\n    </Playground>\n    <blockquote>\n      <p parentName=\"blockquote\">{`此外还支持 `}<inlineCode parentName=\"p\">{`requestMethod`}</inlineCode>{` 方法 需要一个 `}<inlineCode parentName=\"p\">{`() => CancellablePromise<CascaderOptionType[]>`}</inlineCode>{`这样的方法\n会自动请求 `}<inlineCode parentName=\"p\">{`requestMethod`}</inlineCode>{` 加载 `}<inlineCode parentName=\"p\">{`options`}</inlineCode></p>\n      <pre parentName=\"blockquote\"><code parentName=\"pre\" {...{\n          \"className\": \"language-ts\"\n        }}>{`interface CascaderOptionType {\n    value?: string;\n    label?: React.ReactNode;\n    disabled?: boolean;\n    isLeaf?: boolean;\n    loading?: boolean;\n    children?: Array<CascaderOptionType>;\n`}</code></pre>\n    </blockquote>\n    <pre><code parentName=\"pre\" {...{}}>{`[key: string]: any;\n`}</code></pre>\n    <p>{`}`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`\n\\`\\`\\`ts\ntype CancellablePromise<T> = Promise<T> & {\n  cancel(): void;\n};\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"属性properties\"\n    }}>{`属性(Properties)`}</h2>\n    <Props of={Cascader} mdxType=\"Props\" />\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"],"sourceRoot":""}